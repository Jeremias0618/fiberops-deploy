# FiberOps Deploy üöÄ

Repositorio de despliegue automatizado para el sistema **FiberOps 2025**, un sistema de gesti√≥n de infraestructura de fibra √≥ptica desarrollado por Yeremi Tantaraico.

## üìã Descripci√≥n del Proyecto

Este repositorio contiene los scripts de shell y la documentaci√≥n necesaria para desplegar autom√°ticamente el sistema FiberOps en servidores Ubuntu Server 22.04. El depliegue incluye toda la configuraci√≥n del entorno, dependencias y optimizaciones necesarias para el funcionamiento √≥ptimo del sistema.

## üõ†Ô∏è Tecnolog√≠as del Proyecto

### Backend
- **PHP 8.1** - Lenguaje principal del sistema
- **Apache 2.4** - Servidor web
- **PostgreSQL** - Base de datos principal
- **Composer** - Gestor de dependencias PHP

### Extensiones PHP Cr√≠ticas
- `php8.1-mysql` - Conectividad MySQL
- `php8.1-pgsql` - Conectividad PostgreSQL
- `php8.1-ssh2` - Protocolo SSH para gesti√≥n remota
- `php8.1-snmp` - Protocolo SNMP para monitoreo de equipos
- `php8.1-gd` - Manipulaci√≥n de im√°genes
- `php8.1-mbstring` - Soporte multibyte
- `php8.1-curl` - Cliente HTTP
- `php8.1-xml` - Procesamiento XML
- `php8.1-intl` - Internacionalizaci√≥n
- `php8.1-zip` - Compresi√≥n de archivos
- `php8.1-bcmath` - Matem√°ticas de precisi√≥n

### Dependencias del Sistema
- **SNMP** - Monitoreo de equipos de red
- **PostgreSQL** - Base de datos
- **Python 3** - Scripts auxiliares
- **psycopg2** - Conector PostgreSQL para Python

## üì¶ Requisitos del Sistema

### Hardware M√≠nimo
- **CPU**: 2 cores
- **RAM**: 4GB m√≠nimo, 8GB recomendado
- **Disco**: 20GB libres
- **Red**: Conexi√≥n estable a internet

### Software Base
- **Sistema Operativo**: Ubuntu Server 22.04 LTS
- **Usuario**: Ejecutar como root o con permisos sudo
- **Acceso**: SSH habilitado

## üöÄ Scripts de Despliegue

### Archivo: `fiberops_deploy.sh`

Script automatizado que instala y configura todo el entorno necesario para FiberOps.

### Archivo: `verify_fiberops_installation.sh`

Script de verificaci√≥n completo que valida toda la instalaci√≥n del sistema FiberOps, incluyendo servicios, extensiones PHP, configuraciones y dependencias.

### Archivo: `fiberops_system_monitor.sh`

Script de monitoreo en tiempo real del sistema que verifica el rendimiento, uso de recursos, estado de servicios y caracter√≠sticas del hardware del servidor.

### Archivo: `fiberops_removing_notifications.sh`

Script de configuraci√≥n autom√°tica de crontab para el sistema SMS de FiberOps, que programa tareas autom√°ticas para el procesamiento de notificaciones, limpieza de logs y mantenimiento del sistema.

#### Caracter√≠sticas del Script de Instalaci√≥n
- ‚úÖ Instalaci√≥n autom√°tica de todas las dependencias
- ‚úÖ Configuraci√≥n optimizada de PHP y Apache
- ‚úÖ Configuraci√≥n de zona horaria (Per√∫)
- ‚úÖ Verificaci√≥n autom√°tica de instalaciones
- ‚úÖ Configuraci√≥n de permisos y seguridad
- ‚úÖ Mensajes informativos durante el proceso

#### Caracter√≠sticas del Script de Verificaci√≥n
- ‚úÖ Verificaci√≥n completa de servicios del sistema
- ‚úÖ Validaci√≥n de versiones de software instalado
- ‚úÖ Comprobaci√≥n de extensiones PHP requeridas
- ‚úÖ Verificaci√≥n de configuraciones PHP
- ‚úÖ Validaci√≥n de m√≥dulos Apache habilitados
- ‚úÖ Comprobaci√≥n de directorios y permisos
- ‚úÖ Verificaci√≥n de herramientas SNMP
- ‚úÖ Validaci√≥n de dependencias Composer
- ‚úÖ Comprobaci√≥n de conectividad y puertos
- ‚úÖ Configuraci√≥n autom√°tica de crontab
- ‚úÖ Resumen estad√≠stico detallado

#### Caracter√≠sticas del Script de Monitoreo
- ‚úÖ Informaci√≥n detallada del hardware del sistema
- ‚úÖ Monitoreo de CPU con barras de progreso por core
- ‚úÖ An√°lisis de memoria RAM y swap en tiempo real
- ‚úÖ Estad√≠sticas de almacenamiento y uso de disco
- ‚úÖ Monitoreo de interfaces de red y conectividad
- ‚úÖ Estado de servicios FiberOps (Apache, PostgreSQL, etc.)
- ‚úÖ An√°lisis de procesos con mayor consumo de recursos
- ‚úÖ Verificaci√≥n de puertos y conexiones activas
- ‚úÖ Alertas autom√°ticas por umbrales de uso
- ‚úÖ Monitoreo continuo con actualizaci√≥n autom√°tica
- ‚úÖ Logging autom√°tico de m√©tricas del sistema
- ‚úÖ Reportes de rendimiento y salud del sistema

#### Caracter√≠sticas del Script de Crontab SMS
- ‚úÖ Configuraci√≥n autom√°tica de tareas programadas
- ‚úÖ Backup autom√°tico del crontab existente
- ‚úÖ Verificaci√≥n de directorios SMS y creaci√≥n si no existen
- ‚úÖ Programaci√≥n de limpieza autom√°tica de notificaciones
- ‚úÖ Procesamiento autom√°tico de cola SMS
- ‚úÖ Reintento autom√°tico de SMS fallidos
- ‚úÖ Generaci√≥n autom√°tica de estad√≠sticas
- ‚úÖ Limpieza autom√°tica de logs antiguos
- ‚úÖ Verificaci√≥n de salud del sistema SMS
- ‚úÖ Respaldo autom√°tico de configuraciones
- ‚úÖ Creaci√≥n autom√°tica de archivos de log
- ‚úÖ Verificaci√≥n y configuraci√≥n del servicio cron

#### Funcionalidades Principales

1. **Pre-requisitos del Sistema**
   - Deshabilitaci√≥n de IPv6 para evitar problemas de descarga
   - Actualizaci√≥n completa del sistema

2. **Instalaci√≥n de Servicios**
   - Apache 2.4 con m√≥dulos necesarios
   - PHP 8.1 con todas las extensiones requeridas
   - PostgreSQL con extensiones

3. **Configuraci√≥n de Extensiones Especializadas**
   - SSH2 para gesti√≥n remota de equipos
   - SNMP para monitoreo de infraestructura
   - Extensiones de base de datos

4. **Optimizaci√≥n del Entorno**
   - Configuraci√≥n PHP optimizada para FiberOps
   - Zona horaria configurada a Am√©rica/Lima
   - Permisos de directorios configurados

5. **Verificaci√≥n y Validaci√≥n**
   - Estado de servicios
   - Versiones instaladas
   - Extensiones PHP activas
   - Permisos de directorios

## üìñ C√≥mo Usar el Script

### 1. Preparaci√≥n del Servidor
```bash
# Conectar por SSH al servidor Ubuntu 22.04
ssh usuario@tu-servidor-ip

# Actualizar el sistema (opcional, el script lo hace autom√°ticamente)
sudo apt update && sudo apt upgrade -y
```

### 2. Descarga y Ejecuci√≥n
```bash
# Descargar el script de instalaci√≥n
wget https://raw.githubusercontent.com/Jeremias0618/fiberops-deploy/main/fiberops_deploy.sh

# Descargar el script de verificaci√≥n
wget https://raw.githubusercontent.com/Jeremias0618/fiberops-deploy/main/verify_fiberops_installation.sh

# Descargar el script de monitoreo
wget https://raw.githubusercontent.com/Jeremias0618/fiberops-deploy/main/fiberops_system_monitor.sh

# Descargar el script de configuraci√≥n crontab SMS
wget https://raw.githubusercontent.com/Jeremias0618/fiberops-deploy/main/fiberops_removing_notifications.sh

# Dar permisos de ejecuci√≥n
chmod +x fiberops_deploy.sh verify_fiberops_installation.sh fiberops_system_monitor.sh fiberops_removing_notifications.sh

# Ejecutar instalaci√≥n como root
sudo ./fiberops_deploy.sh

# Despu√©s de la instalaci√≥n, verificar el sistema
sudo ./verify_fiberops_installation.sh

# Monitorear el sistema en tiempo real
sudo ./fiberops_system_monitor.sh

# Configurar tareas autom√°ticas para SMS
sudo ./fiberops_removing_notifications.sh
```

### 3. Proceso de Instalaci√≥n
El script ejecutar√° autom√°ticamente:
- Instalaci√≥n de Apache, PHP 8.1, PostgreSQL
- Configuraci√≥n de extensiones PHP especializadas
- Instalaci√≥n de Composer
- Configuraci√≥n de zona horaria
- Optimizaci√≥n de PHP.ini
- Verificaci√≥n final del sistema

**Tiempo estimado**: 15-20 minutos dependiendo de la velocidad de internet.

## üìä Resultados de la Instalaci√≥n

### Servicios Instalados y Configurados
- ‚úÖ **Apache 2.4** - Servidor web activo y configurado
- ‚úÖ **PHP 8.1** - Con todas las extensiones necesarias
- ‚úÖ **PostgreSQL** - Base de datos lista para usar
- ‚úÖ **Composer** - Gestor de dependencias PHP
- ‚úÖ **SNMP** - Para monitoreo de equipos
- ‚úÖ **SSH2** - Para gesti√≥n remota

### Directorios Creados
```
/var/www/html/          # Directorio principal del proyecto
/var/www/html/logs/     # Directorio de logs (permisos 777)
```

### Configuraciones Aplicadas
- **Zona horaria**: America/Lima (Per√∫)
- **PHP.ini optimizado**:
  - `max_execution_time = 300`
  - `memory_limit = 512M`
  - `upload_max_filesize = 100M`
  - `post_max_size = 100M`
- **Permisos**: 777 para /var/www/html/

### Acceso al Sistema
- **URL**: `http://tu-servidor-ip/`
- **Directorio**: `/var/www/html/`

## üîß Pr√≥ximos Pasos Despu√©s de la Instalaci√≥n

1. **Subir el c√≥digo de FiberOps**
   ```bash
   # Copiar archivos del proyecto a /var/www/html/
   cp -r /ruta/al/codigo/fiberops/* /var/www/html/
   ```

2. **Configurar base de datos PostgreSQL**
   ```bash
   # Crear usuario y base de datos
   sudo -u postgres createuser --interactive
   sudo -u postgres createdb fiberops_db
   ```

3. **Configurar archivos de entorno**
   - Configurar `.env` con datos de conexi√≥n
   - Ajustar `config.php` seg√∫n necesidades

4. **Instalar dependencias del proyecto**
   ```bash
   cd /var/www/html/
   composer install
   ```

5. **Verificar permisos finales**
   ```bash
   chown -R www-data:www-data /var/www/html/
   chmod -R 755 /var/www/html/
   ```

## üîç Verificaci√≥n del Sistema

### Script de Verificaci√≥n Autom√°tica
```bash
# Ejecutar verificaci√≥n completa del sistema
sudo ./verify_fiberops_installation.sh
```

El script de verificaci√≥n realizar√° **11 categor√≠as de verificaci√≥n**:

1. **Servicios del Sistema** - Apache2 y PostgreSQL
2. **Versiones de Software** - PHP, Apache, PostgreSQL, Composer
3. **Extensiones PHP Requeridas** - SSH2, SNMP, PostgreSQL, GD, etc.
4. **Configuraci√≥n PHP** - Zona horaria, memory limit, execution time
5. **M√≥dulos Apache** - Rewrite, Headers, PHP 8.1
6. **Directorios y Permisos** - /var/www/html/, logs, permisos
7. **Herramientas SNMP** - SNMP tools, Python3, psycopg2
8. **Composer y Dependencias** - Autoloader, dependencias del proyecto
9. **Conectividad y Puertos** - Puerto 80 (HTTP), 5432 (PostgreSQL)
10. **Configuraci√≥n del Sistema** - Zona horaria, IPv6
11. **Configuraci√≥n de Crontab** - Configuraci√≥n autom√°tica de tareas programadas

### Comandos de Verificaci√≥n Manual
```bash
# Estado de servicios
systemctl status apache2
systemctl status postgresql

# Versiones instaladas
php -v
composer --version
apache2 -v

# Extensiones PHP activas
php -m | grep -E "(ssh2|snmp|pgsql|gd|mbstring)"

# Verificar permisos
ls -la /var/www/html/
```

### Resultados de la Verificaci√≥n
El script proporciona un **resumen estad√≠stico** con:
- Total de verificaciones realizadas
- N√∫mero de verificaciones exitosas
- Advertencias encontradas
- Errores detectados
- Estado general del sistema

## üìä Monitoreo del Sistema

### Script de Monitoreo en Tiempo Real
```bash
# Monitoreo completo una vez
sudo ./fiberops_system_monitor.sh

# Monitoreo continuo (cada 5 segundos)
sudo ./fiberops_system_monitor.sh -c 5

# Mostrar ayuda
sudo ./fiberops_system_monitor.sh -h
```

### Caracter√≠sticas del Monitoreo
El script `fiberops_system_monitor.sh` proporciona:

#### üñ•Ô∏è **Informaci√≥n del Sistema**
- Hostname, OS, Kernel, Uptime
- Load Average y fecha actual
- Informaci√≥n detallada del hardware

#### üîß **Monitoreo de Hardware**
- **Procesador**: Modelo, arquitectura, cores, frecuencia
- **Memoria RAM**: Total, usada, libre, disponible, porcentaje de uso
- **Almacenamiento**: Tama√±o, uso, disponible por dispositivo

#### üìä **An√°lisis de Rendimiento**
- **CPU**: Uso actual con barras de progreso por core
- **Memoria**: Detalles de RAM y swap
- **Procesos**: Top 10 procesos por CPU y memoria
- **Temperatura**: Monitoreo de temperatura del CPU

#### üåê **Red y Conectividad**
- Interfaces de red activas
- Estad√≠sticas de tr√°fico (RX/TX)
- Conexiones activas (establecidas, escuchando)
- Top 5 IPs con m√°s conexiones

#### üîß **Servicios FiberOps**
- Estado de Apache2, PostgreSQL, Cron, SSH
- Verificaci√≥n de puertos (80, 443, 5432, 22)
- Uso de memoria por servicio

#### ‚ö†Ô∏è **Alertas Autom√°ticas**
- **CPU**: Alerta si uso > 80%
- **Memoria**: Alerta si uso > 85%
- **Disco**: Alerta si uso > 90%
- **Temperatura**: Alerta si > 80¬∞C

#### üìà **Reportes y Logging**
- Resumen de rendimiento del sistema
- Logging autom√°tico en `/var/log/fiberops_monitor.log`
- Estado general con contador de alertas
- M√©tricas hist√≥ricas para an√°lisis

## ‚è∞ Configuraci√≥n de Tareas Autom√°ticas (Crontab SMS)

### Script de Configuraci√≥n Autom√°tica
```bash
# Configurar tareas autom√°ticas para sistema SMS
sudo ./fiberops_removing_notifications.sh
```

### ¬øQu√© hace el script?
El script `fiberops_removing_notifications.sh` configura autom√°ticamente las tareas programadas (crontab) necesarias para el funcionamiento del sistema SMS de FiberOps.

### Funcionalidades del Script

#### üïí **Tareas Programadas Configuradas**
1. **Limpieza de Notificaciones** - Diaria a las 23:59
   - Ejecuta: `clear_notifications.php`
   - Log: `cleanup.log`

2. **Procesamiento de Cola SMS** - Cada 5 minutos
   - Ejecuta: `process_queue.php`
   - Log: `queue.log`

3. **Reintento de SMS Fallidos** - Cada 30 minutos
   - Ejecuta: `retry_failed.php`
   - Log: `retry.log`

4. **Generaci√≥n de Estad√≠sticas** - Diaria a las 06:00
   - Ejecuta: `stats_generator.php`
   - Log: `stats.log`

5. **Limpieza de Logs Antiguos** - Domingos a las 02:00
   - Ejecuta: `cleanup_old_logs.php`
   - Log: `maintenance.log`

6. **Verificaci√≥n de Salud SMS** - Cada hora
   - Ejecuta: `health_check.php`
   - Log: `health.log`

7. **Respaldo de Configuraciones** - Diario a las 03:00
   - Ejecuta: `backup_config.php`
   - Log: `backup.log`

#### üîß **Caracter√≠sticas del Script**
- **Backup Autom√°tico**: Crea respaldo del crontab existente
- **Verificaci√≥n de Directorios**: Crea directorios SMS si no existen
- **Creaci√≥n de Logs**: Genera archivos de log autom√°ticamente
- **Verificaci√≥n de Servicios**: Asegura que el servicio cron est√© activo
- **Validaci√≥n de PHP**: Verifica que PHP est√© disponible
- **Mensajes Informativos**: Proporciona feedback detallado del proceso

#### üìÅ **Estructura de Directorios Creados**
```
/var/www/html/sms/
‚îú‚îÄ‚îÄ scripts/          # Scripts PHP para tareas autom√°ticas
‚îú‚îÄ‚îÄ logs/            # Archivos de log de las tareas
‚îÇ   ‚îú‚îÄ‚îÄ cleanup.log
‚îÇ   ‚îú‚îÄ‚îÄ queue.log
‚îÇ   ‚îú‚îÄ‚îÄ retry.log
‚îÇ   ‚îú‚îÄ‚îÄ stats.log
‚îÇ   ‚îú‚îÄ‚îÄ maintenance.log
‚îÇ   ‚îú‚îÄ‚îÄ health.log
‚îÇ   ‚îî‚îÄ‚îÄ backup.log
‚îî‚îÄ‚îÄ clear_notifications.php  # Script principal de limpieza
```

#### üéØ **C√≥mo Funciona**
1. **Verificaci√≥n**: Comprueba permisos root y dependencias
2. **Backup**: Crea respaldo del crontab actual
3. **Configuraci√≥n**: Agrega tareas SMS al crontab
4. **Validaci√≥n**: Verifica que las tareas se agregaron correctamente
5. **Preparaci√≥n**: Crea directorios y archivos de log necesarios
6. **Verificaci√≥n Final**: Confirma que el servicio cron est√© activo

#### üìã **Comandos √ötiles Despu√©s de la Configuraci√≥n**
```bash
# Ver tareas programadas configuradas
crontab -l

# Editar tareas programadas manualmente
crontab -e

# Verificar estado del servicio cron
systemctl status cron

# Ver logs de las tareas autom√°ticas
tail -f /var/www/html/sms/logs/cleanup.log
tail -f /var/www/html/sms/logs/queue.log

# Verificar ejecuci√≥n de tareas
grep CRON /var/log/syslog | tail -10
```

#### ‚ö†Ô∏è **Requisitos**
- Ejecutar como root o con permisos sudo
- PHP instalado y disponible en `/usr/bin/php`
- Servicio cron instalado y activo
- Acceso de escritura a `/var/www/html/sms/`

## üìß Soporte

- **Autor**: Yeremi Tantaraico
- **Email**: yeremitantaraico@gmail.com
- **Versi√≥n del Script**: 2.0 (Corregida)
- **Sistema Objetivo**: Ubuntu Server 22.04

## üìù Notas Importantes

- El script debe ejecutarse como root o con permisos sudo
- Se requiere conexi√≥n a internet estable
- El proceso puede tomar 15-20 minutos
- Se crean respaldos autom√°ticos de configuraciones originales
- Todos los servicios se configuran para iniciar autom√°ticamente

---

**‚ö†Ô∏è Importante**: Este script est√° dise√±ado espec√≠ficamente para Ubuntu Server 22.04. Para otras distribuciones, puede requerir modificaciones.
